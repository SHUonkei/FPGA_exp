# FPGA Game Implementation Documentation

## 概要
本ドキュメントはFPGA上で動作するゲームの仕様と実装について説明します。以下の機能を実装します:

- **画面構成**:
  - スタート画面
  - ゲーム画面
  - 結果画面

- **操作**:
  - 7セグ表示: ゲームの残り時間 (最大99秒)
  - キーパッド入力によるプレイヤー操作
  - サウンド再生 (BGMおよび効果音)

- **ゲームロジック**:
  - 斜め反射のランダム性
  - スピード調整
  - 1Pモード (CPUプレイヤー)

---

## 機能仕様

### 画面
- **スタート画面**:
  - スピード選択 (`A`, `B`, `C`ボタン: 遅い < 普通 < 速い)
  - モード選択 (`1`: 1Pモード, `2`: 対戦モード)
  - `E`ボタンでゲーム開始

- **ゲーム画面**:
  - 7セグで残り時間を表示
  - プレイヤーのスコアを内部変数で管理
  - ラケットでボールを打ち返すシステム
  - プレイヤー操作:
    - プレイヤー1:
      - `1`, `0`: 上下移動
      - `7`: 強打
      - `4`: 弱打
    - プレイヤー2:
      - `A`, `D`: 上下移動
      - `B`: 強打
      - `C`: 弱打
  - ランダム反射と速度調整

- **結果画面**:
  - 勝敗結果の表示

---

### 内部仕様

#### 状態管理 (`status`)
- ゲームの進行状況を管理:
  - `START`: スタート画面
  - `PLAY`: ゲーム中
  - `END`: 結果画面

---

## 関数設計

### スタート画面の処理

#### `show_start()`
スタート画面を表示し、スピードとモードの選択を行う。
- **変数**:
  - `speed`: 選択された速度 (`A`, `B`, `C`)
  - `mode`: 選択されたモード (`1` = 1Pモード, `2` = 対戦モード)

- **関数**:
  - `set_speed()`: スピードを設定
    - `A` < `B` < `C`の順に速度を増加
  - `set_mode()`: ゲームモードを設定
    - `1`: 1Pモード (CPUが操作)
    - `2`: 対戦モード (プレイヤー2が操作)
  - `start_game()`: `E`ボタンでゲーム開始

---

### ゲーム中の処理

#### `play_game()`
ゲームロジックの中心となる関数。
- **変数**:
  - `time_left`: 残り時間
  - `score_p1`, `score_p2`: プレイヤーのスコア
  - `ball_speed`: 現在のボール速度
  - `ball_direction`: ボールの移動方向

- **関数**:
  - `start_timer()`: タイマーを開始
  - `update_ball_speed(hit_type)`: ボール速度を更新
    - `hit_type`: 強打(`7`, `B`)または弱打(`4`, `C`)の判定
  - `reflect_ball_randomly()`: ボールの反射方向をランダムに設定
  - `check_collision()`: ボールとラケットの衝突を判定
  - `update_score()`: スコアを更新
  - `end_game()`: ゲーム終了条件をチェックし、終了処理を実行

---

### 結果画面の処理

#### `show_end()`
結果画面を表示し、スコアと勝敗を提示。
- **変数**:
  - `score_p1`, `score_p2`: 最終スコア
- **関数**:
  - `display_results()`: 勝者を表示

---

### その他の補助関数
- `play_sound(event)`: イベントに応じた効果音を再生
  - `bgm`: ゲーム中のBGM
  - `hit_sound`: ラケットにボールが当たったときの音
- `reset_game()`: ゲーム状態を初期化

---

## 注意事項
- **CPU (1Pモード)**:
  - CPUは常に最強モードで、ボールを必ず打ち返します。
- **スピード調整**:
  - スタート画面でのみ設定可能です。

